# 画面仕様書：全体一覧画面（全カテゴリ横断）

---

## 基本情報

- **画面名**：全体一覧画面（全カテゴリ横断）
- **URL**：`/expenses/all`
- **HTTPメソッド**：GET
- **Controller**：`AllExpensesController@index`
- **Bladeテンプレート**：`resources/views/expenses/all.blade.php`
- **渡すデータ**：
  - `expenses` 全カテゴリの共通データ（ステータス、合計金額、申請者など）
  - 各カテゴリの明細テーブル（必要に応じてEagerロード）
  - ログインユーザーのロール・権限情報（表示制御に使用）

---

## 使用テーブル

| テーブル名               | 用途                                               |
|--------------------------|----------------------------------------------------|
| `expenses`               | 経費共通情報（申請者、金額、ステータス、カテゴリ） |
| `users`                  | 申請者情報、ログインユーザー情報                     |
| `<type>_expenses`        | 明細情報（横断出力は必要に応じて動的JOINまたは表示のみ） |

---

## 表示項目

| 項目         | 説明                                |
|--------------|-------------------------------------|
| ID           | 伝票番号（expenses.id）              |
| カテゴリ     | `transportation` などの種別           |
| 申請者名     | users.name など                       |
| 合計金額     | 各明細の合計（expenses.total_amount） |
| ステータス   | `draft`, `submitted`, `approved` の状態 |
| 登録日       | 登録日時（expenses.created_at）        |
| 操作         | 編集・CSV出力など（条件による）        |

---

## ステータス定義

| ステータスコード | 表示名   | 備考                  |
|------------------|----------|-----------------------|
| `draft`          | 下書き   | 編集可                |
| `submitted`      | 申請中   | 編集不可、承認可      |
| `approved`       | 承認済   | 編集不可、出力対象     |

---

## 操作・機能

| 機能         | 説明                                         | 権限               |
|--------------|----------------------------------------------|--------------------|
| 編集ボタン   | ステータスが `draft` の場合のみ編集可能         | 一般ユーザーのみ     |
| 申請ボタン   | 一覧から直接申請できる構成（必要に応じて）       | 一般ユーザー         |
| 承認ボタン   | `submitted` のレコードのみ対象                  | 承認者のみ           |
| CSV出力      | `submitted` or `approved` のデータを出力        | 管理者・承認者も対象可 |
| フィルタ      | カテゴリ別・ステータス別に絞り込み表示           | 全ロール共通         |

---

## 認証・権限

この画面はログイン必須（`auth` ミドルウェア）

| ロール         | 表示内容                        | 備考                       |
|----------------|---------------------------------|----------------------------|
| 一般ユーザー     | 自分の全カテゴリ申請のみ表示         | 編集・申請可                  |
| 承認者           | 承認対象カテゴリかつ `submitted` のみ表示 | 承認可                       |
| 管理者（is_admin） | 全申請を表示                         | CSV出力・集計目的なども想定    |

---

## 実装準備完了チェック

- ☑ URL・Controller・Blade の構成が定義されている
- ☑ 全カテゴリの `expenses` データを横断して取得できる
- ☑ 各ステータスに応じた操作ボタン制御ができる
- ☑ フィルタや出力も含めた統合一覧設計がなされている

---
