# 画面仕様書：出張旅費一覧画面

---

## 基本情報

-   **画面名**：出張旅費一覧画面
-   **URL**：`/expenses/business_trip`
-   **HTTP メソッド**：GET
-   **Controller**：`BusinessTripController@index`
-   **Blade テンプレート**：`resources/views/business_trip/index.blade.php`
-   **渡すデータ**：
    -   ログインユーザー情報（`auth()` により取得）
    -   対象ユーザーの `expenses` レコード（expense_type = 'business_trip'）
    -   関連する `business_trip_expenses` 明細（1:N）
    -   各レコードのステータス・合計金額など

---

## 使用テーブル

| テーブル名               | 用途                                           |
| ------------------------ | ---------------------------------------------- |
| `expenses`               | 経費共通情報（申請者、ステータス、合計金額等） |
| `business_trip_expenses` | 明細情報（出発地・目的地・日付・金額など）     |
| `users`                  | ログインユーザー情報・承認者・権限チェック等   |

---

## 表示項目

| 項目           | 説明                                           |
| -------------- | ---------------------------------------------- |
| 出張日         | 明細の代表日付（最初の行など）                 |
| 出発地／目的地 | 出張元・出張先                                 |
| 目的           | 出張目的内容（必要に応じて簡略表示）           |
| 金額合計       | 明細の合算額                                   |
| ステータス     | 下書き／申請中／承認済（定義は下記）           |
| 操作           | 編集／申請／承認（ステータスと権限により制御） |

---

## ステータス定義

| ステータスコード | 表示名 | 意味               |
| ---------------- | ------ | ------------------ |
| `draft`          | 下書き | 編集・申請可能     |
| `submitted`      | 申請中 | 承認者の承認待ち   |
| `approved`       | 承認済 | 編集不可・出力可能 |

---

## ボタン／機能一覧

| ボタン名 | 機能                                       | 備考                                             |
| -------- | ------------------------------------------ | ------------------------------------------------ |
| 新規作成 | `/expenses/business_trip/create` に遷移    | 明細追加画面へ                                   |
| 編集     | `/expenses/business_trip/{id}/edit` に遷移 | ステータスが `draft` の場合のみ編集可能          |
| 申請     | POST で申請処理を実行                      | 明細が入力済であることなどをバリデーション       |
| 承認     | POST で承認処理を実行                      | `submitted` のデータのみ、承認者ロールのみ表示   |
| CSV 出力 | CSV 形式で一覧データをダウンロード         | `submitted` または `approved` の申請のみ出力対象 |

---

## 明細の扱い

-   `expenses`（親）と `business_trip_expenses`（明細）は 1:N
-   一覧では合算・簡略表示、編集で全明細を展開

---

## 認証・権限

この画面はログイン必須（`auth` ミドルウェア適用）

| ロール                | 表示対象                   | 操作内容                                 |
| --------------------- | -------------------------- | ---------------------------------------- |
| 一般ユーザー          | 自分の出張旅費申請         | 新規作成、編集（下書き）、申請、CSV 出力 |
| 承認者（is_approver） | 承認対象となる申請のみ表示 | 承認処理、CSV 出力（申請中のみ）         |
| 管理者（is_admin）    | 全ユーザーの出張旅費を表示 | 編集補助、全件 CSV 出力など              |

---

## 実装準備完了チェック（この画面）

-   ☑ URL・Controller・Blade の構成が定義されている
-   ☑ 表示項目・ボタン・操作条件が明記されている
-   ☑ 使用テーブルとリレーションが明確である
-   ☑ ステータスと権限による制御内容が網羅されている
-   ☑ 他カテゴリとの共通ルールに従って構成されている

---
